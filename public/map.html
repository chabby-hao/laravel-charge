<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <!-- 引入 echarts.js -->
    <!--引入百度地图的jssdk，这里需要使用你在百度地图开发者平台申请的 ak-->
    <script src="https://api.map.baidu.com/api?v=4.0&ak=QhhNgV6Mb4rVFtGQKhiPoETzf1VpK1vM"></script>
    <!-- 引入 ECharts -->
    <script src="./echarts.min.js"></script>
    <!-- 引入百度地图扩展 -->
    <script src="./bmap.min.js"></script>
</head>
<style>
    html, body {
        width: 100%;
        height: 100%;
        margin: 0;
    }

    #main {
        width: 100%;
        height: 100%;
    }

    #bottom{
        position: absolute;
        bottom: 0;
        left: 0;
        right:0;
        margin:0 auto;
        background:rgba(70,70,70,0.4);
        width: 90%;
        height: 85px;
    }
</style>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div id="main"></div>
<div id="bottom"></div>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'));


    var url = 'http://work.longlongwalk.com/map/getEbikeData';
    var convertData = [];
    $.ajax({
        type: "get",
        dataType: 'jsonp',
        //async:false,
        url: url,//数据类型为jsonp
        jsonp: "jsonpCallback",//服务端用于接收callback调用的function名的参数
        success: function (res) {
            console.log(res);
            convertData = res.gps;
            option = {
                title: {
                    text: '全国智慧芯电动车分布',
                    subtext: 'data from 安骑科技',
                    //sublink: 'http://www.pm25.in',
                    left: 'center'
                },
                tooltip: {//弹框
                    show: true,
                    position: 'top',
                    textStyle: {},
                    padding:[
                        5,  // 上
                        15, // 右
                        5,  // 下
                        15, // 左
                    ],
                    formatter: function (params, ticket, callback) {
                        console.log(params);
                        return '<img src="cheliang2@2x.png"/>&nbsp;&nbsp;&nbsp;&nbsp;' + '最近一次定位<br>· ' + params.data.time + '<br>· ' + params.data.address;
                    },
//                    backgroundColor:'rgb(46,224,224)',
                },
                bmap: {
                    center: [104.114129, 37.550339],
                    zoom: 5,
                    roam: true,
                    mapStyle: {}
                },
                series: [
                    {
                        name: 'udid',
                        type: 'scatter',
                        large: true,
                        coordinateSystem: 'bmap',
                        data: convertData,
                        symbolSize: function (val) {
                            return 12;
                        },
                        hoverAnimation: true,
                        tooltip: {},
                        label: {
                            normal: {
                                formatter: '{b}',
                                position: 'top',
                                show: false
                            },
                            emphasis: {
                                show: false
                            },
                        },
                        itemStyle: {
                            normal: {
                                color: 'rgb(46,224,224)'
                            }
                        }
                    },
                    /*{
                     name: 'Top 5',
                     type: 'effectScatter',
                     coordinateSystem: 'bmap',
                     data: convertData(data.sort(function (a, b) {
                     return b.value - a.value;
                     }).slice(0, 6)),
                     symbolSize: function (val) {
                     return val[2] / 10;
                     },
                     showEffectOn: 'render',
                     rippleEffect: {
                     brushType: 'stroke'
                     },
                     hoverAnimation: true,
                     label: {
                     normal: {
                     formatter: '{b}',
                     position: 'right',
                     show: true
                     }
                     },
                     itemStyle: {
                     normal: {
                     color: 'purple',
                     shadowBlur: 10,
                     shadowColor: '#333'
                     }
                     },
                     zlevel: 1
                     }*/
                ]
            };
            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);
        }
    })

    /*    var convertData = function (data) {
     var res = [];
     for (var i = 0; i < data.length; i++) {
     var geoCoord = geoCoordMap[data[i].name];
     if (geoCoord) {
     res.push({
     name: data[i].name,
     value: geoCoord.concat(data[i].value)
     });
     }
     }
     console.log(res);
     return res;
     };*/


</script>
</body>
</html>